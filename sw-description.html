

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SWUpdate:使用默认解析器的语法和标记 &mdash; Embedded Software Update Documentation 2018.11 文档</title>
  

  
  
    <link rel="shortcut icon" href="_static/SWUpdate.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="Update images from verified source" href="signed_images.html" />
    <link rel="prev" title="SWUpdate: 嵌入式系统的软件升级" href="swupdate.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Embedded Software Update Documentation
          

          
          </a>

          
            
            
              <div class="version">
                2018.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">嵌入式系统的软件管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="licensing.html">许可证</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="swupdate.html">SWUpdate: 嵌入式系统的软件升级</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">SWUpdate:使用默认解析器的语法和标记</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">处理配置的差异</a></li>
<li class="toctree-l2"><a class="reference internal" href="#collections">软件集合</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">查找文件元素的优先级</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-links">Using links</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">硬件兼容性</a></li>
<li class="toctree-l2"><a class="reference internal" href="#partitions-ubi">partitions : UBI 布局</a></li>
<li class="toctree-l2"><a class="reference internal" href="#images">images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#files">Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scripts">Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lua">Lua</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shellscript">shellscript</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preinstall">preinstall</a></li>
<li class="toctree-l3"><a class="reference internal" href="#postinstall">postinstall</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bootloader">bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">特定的板级设置</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">软件集合和操作模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">检查已安装软件的版本</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">嵌入脚本</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sw-description-attribute-reference">属性参考</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="signed_images.html">Update images from verified source</a></li>
<li class="toctree-l1"><a class="reference internal" href="encrypted_images.html">Symmetrically Encrypted Update Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="handlers.html">Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongoose.html">Mongoose daemon mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="suricatta.html">Suricatta daemon mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="swupdate-ipc.html">SWUpdate: API for external programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="progress.html">Getting information on running update</a></li>
<li class="toctree-l1"><a class="reference internal" href="building-with-yocto.html">meta-swupdate: building with Yocto</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="help_and_support.html">Help and support</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to SWUpdate</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Project’s road-map</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Embedded Software Update Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>SWUpdate:使用默认解析器的语法和标记</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/sw-description.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="swupdate">
<h1>SWUpdate:使用默认解析器的语法和标记<a class="headerlink" href="#swupdate" title="永久链接至标题">¶</a></h1>
<div class="section" id="id1">
<h2>介绍<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>SWUpdate使用库“libconfig”作为镜像描述的默认解析器。
但是，可以扩展SWUpdate并添加一个自己的解析器，
以支持不同于libconfig的语法和语言。
在examples目录中，有一个用Lua编写的，支持解析XML形式
描述文件的解析器。</p>
<p>使用默认解析器，则sw-description遵循libconfig手册中描述的语法规则。
请参阅http://www.hyperrealm.com/libconfig/libconfig_manual.html
以了解基本类型。
整个描述必须包含在sw-description文件中:
SWUpdate不允许使用#include指令。
下面的例子更好地解释了当前实现的标记:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">software</span> <span class="o">=</span>
<span class="p">{</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Firmware update for XXXXX Project&quot;</span><span class="p">;</span>

        <span class="n">hardware</span><span class="o">-</span><span class="n">compatibility</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;1.2&quot;</span><span class="p">,</span> <span class="s2">&quot;1.3&quot;</span><span class="p">];</span>

        <span class="o">/*</span> <span class="n">partitions</span> <span class="n">tag</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">to</span> <span class="n">resize</span> <span class="n">UBI</span> <span class="n">partitions</span> <span class="o">*/</span>
        <span class="n">partitions</span><span class="p">:</span> <span class="p">(</span> <span class="o">/*</span> <span class="n">UBI</span> <span class="n">Volumes</span> <span class="o">*/</span>
                <span class="p">{</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;rootfs&quot;</span><span class="p">;</span>
                        <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;mtd4&quot;</span><span class="p">;</span>
                        <span class="n">size</span> <span class="o">=</span> <span class="mi">104896512</span><span class="p">;</span> <span class="o">/*</span> <span class="ow">in</span> <span class="nb">bytes</span> <span class="o">*/</span>
                <span class="p">},</span>
                <span class="p">{</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span><span class="p">;</span>
                        <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;mtd5&quot;</span><span class="p">;</span>
                        <span class="n">size</span> <span class="o">=</span> <span class="mi">50448384</span><span class="p">;</span> <span class="o">/*</span> <span class="ow">in</span> <span class="nb">bytes</span> <span class="o">*/</span>
                <span class="p">}</span>
        <span class="p">);</span>


        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">{</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;rootfs.ubifs&quot;</span><span class="p">;</span>
                        <span class="n">volume</span> <span class="o">=</span> <span class="s2">&quot;rootfs&quot;</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;swupdate.ext3.gz.u-boot&quot;</span><span class="p">;</span>
                        <span class="n">volume</span> <span class="o">=</span> <span class="s2">&quot;fs_recovery&quot;</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;sdcard.ext3.gz&quot;</span><span class="p">;</span>
                        <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mmcblk0p1&quot;</span><span class="p">;</span>
                        <span class="n">compressed</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;bootlogo.bmp&quot;</span><span class="p">;</span>
                        <span class="n">volume</span> <span class="o">=</span> <span class="s2">&quot;splash&quot;</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;uImage.bin&quot;</span><span class="p">;</span>
                        <span class="n">volume</span> <span class="o">=</span> <span class="s2">&quot;kernel&quot;</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;fpga.txt&quot;</span><span class="p">;</span>
                        <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;fpga&quot;</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">);</span>

        <span class="n">files</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">{</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;README&quot;</span><span class="p">;</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/README&quot;</span><span class="p">;</span>
                        <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mmcblk0p1&quot;</span><span class="p">;</span>
                        <span class="n">filesystem</span> <span class="o">=</span> <span class="s2">&quot;vfat&quot;</span>
                <span class="p">}</span>
        <span class="p">);</span>

        <span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">{</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;erase_at_end&quot;</span><span class="p">;</span>
                        <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;lua&quot;</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;display_info&quot;</span><span class="p">;</span>
                        <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;lua&quot;</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">);</span>

        <span class="n">bootenv</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">{</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;bootloader-env&quot;</span><span class="p">;</span>
                        <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;bootloader&quot;</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;vram&quot;</span><span class="p">;</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;4M&quot;</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;addfb&quot;</span><span class="p">;</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;setenv bootargs $</span><span class="si">{bootargs}</span><span class="s2"> omapfb.vram=1:2M,2:2M,3:2M omapdss.def_disp=lcd&quot;</span>
                <span class="p">}</span>
        <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>第一个标签是“软件”。整个描述包含在这个标签中。
可以使用 <a class="reference internal" href="#id6">特定的板级设置</a> _对每个设备的设置进行分组。</p>
</div>
<div class="section" id="id2">
<h2>处理配置的差异<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>这个概念可以扩展到交付单个映像，在其中包含用于多个不同设备的发布。
每个设备都有自己的内核、dtb和根文件系统，或者它们可以共享某些部分。</p>
<p>目前，这是通过编写自己的解析器来管理的(并且已经在实际项目中使用)，
解析器在识别出软件当前运行在什么设备上之后，检查必须安装哪些镜像。
因为外部解析器可以用Lua编写，而且它是完全可定制的，
所以每个人都可以设置自己的规则。
对于这个特定的例子，sw-description是用XML格式编写的，
带有标识来标记每个设备对应的镜像。要运行它需要liblxp库。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;software version=&quot;1.0&quot;&gt;
  &lt;name&gt;Update Image&lt;/name&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;description&gt;Firmware for XXXXX Project&lt;/description&gt;

  &lt;images&gt;
    &lt;image device=&quot;firstdevice&quot; version=&quot;0.9&quot;&gt;
      &lt;stream name=&quot;dev1-uImage&quot; type=&quot;ubivol&quot; volume=&quot;kernel&quot; /&gt;
      &lt;stream name=&quot;dev1.dtb&quot; type=&quot;ubivol&quot; volume=&quot;dtb&quot; /&gt;
      &lt;stream name=&quot;dev1-rootfs.ubifs&quot; type=&quot;ubivol&quot; volume=&quot;rootfs&quot;/&gt;
      &lt;stream name=&quot;dev1-uboot-env&quot; type=&quot;uboot&quot; /&gt;
      &lt;stream name=&quot;raw_vfat&quot; type=&quot;raw&quot; dest=&quot;/dev/mmcblk0p4&quot; /&gt;
      &lt;stream name=&quot;sdcard.lua&quot; type=&quot;lua&quot; /&gt;
    &lt;/image&gt;

    &lt;image device=&quot;seconddevice&quot; version=&quot;0.9&quot;&gt;
      &lt;stream name=&quot;dev2-uImage&quot; type=&quot;ubivol&quot; volume=&quot;kernel&quot; /&gt;
      &lt;stream name=&quot;dev2.dtb&quot; rev=&quot;0.9&quot; type=&quot;ubivol&quot; volume=&quot;dtb&quot; /&gt;
      &lt;stream name=&quot;dev2-rootfs.ubifs&quot; type=&quot;ubivol&quot; volume=&quot;rootfs&quot;/&gt;
    &lt;/image&gt;
  &lt;/images&gt;
&lt;/software&gt;
</pre></div>
</div>
<p>支持本例子的解析器位于/examples目录中。
通过识别哪个是正在运行的设备，解析器返回一个表，
其中包含必须安装的镜像及其关联的处理程序。</p>
<p>读取交付的镜像时，SWUpdate将忽略解析器处理列表之外的所有镜像。
通过这种方式，可以使用单个交付镜像来更新多个设备。</p>
<p>默认解析器也支持多个设备。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">software</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">;</span>

    <span class="n">target</span><span class="o">-</span><span class="mi">1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                    <span class="p">{</span>
                            <span class="o">...</span>
                    <span class="p">}</span>
            <span class="p">);</span>
    <span class="p">};</span>

    <span class="n">target</span><span class="o">-</span><span class="mi">2</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                    <span class="p">{</span>
                            <span class="o">...</span>
                    <span class="p">}</span>
            <span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>通过这种方式，可以使用单个镜像为你的所有设备提供软件。</p>
<p>默认情况下，硬件信息是从 <cite>/etc/hwrevision</cite> 文件中提取的。
文件应包含单行信息，格式如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">boardname</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">revision</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><cite>&lt;revision&gt;</cite> 将用于与硬件兼容列表匹配</li>
<li><cite>&lt;boardname&gt;</cite> 可用于对板子的具体设置进行分组</li>
</ul>
</div>
<div class="section" id="collections">
<span id="id3"></span><h2>软件集合<a class="headerlink" href="#collections" title="永久链接至标题">¶</a></h2>
<p>软件集合和操作模式可用于实现双拷贝策略。
最简单的情况是为固件映像定义两个安装位置，
并在调用 <cite>SWUpdate</cite> 时选择适当的镜像。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">software</span> <span class="o">=</span>
<span class="p">{</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">;</span>

        <span class="n">stable</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">copy</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                        <span class="p">{</span>
                                <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mtd4&quot;</span>
                                <span class="o">...</span>
                        <span class="p">}</span>
                        <span class="p">);</span>
                <span class="p">}</span>
                <span class="n">copy</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                        <span class="p">{</span>
                                <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mtd5&quot;</span>
                                <span class="o">...</span>
                        <span class="p">}</span>
                        <span class="p">);</span>
                <span class="p">}</span>
        <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>通过这种方式，可以指定 <cite>copy-1</cite> 安装到 <cite>/dev/mtd4</cite> ，
而 <cite>copy-2</cite> 安装到 <cite>/dev/mtd5</cite> 。
通过正确选择安装位置， <cite>SWUpdate</cite> 将更新另一个插槽中的固件。</p>
<p>具体镜像的选择方法超出了SWUpdate的范围内，
用户要负责调用 <cite>SWUpdate</cite> 并传入适当的设置。</p>
</div>
<div class="section" id="id4">
<h2>查找文件元素的优先级<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>SWUpdate根据以下优先级搜索sdw-description文件中的条目:</p>
<ol class="arabic simple">
<li>尝试 &lt;boardname&gt;.&lt;selection&gt;.&lt;mode&gt;.&lt;entry&gt;</li>
<li>尝试 &lt;selection&gt;.&lt;mode&gt;.&lt;entry&gt;</li>
<li>尝试 &lt;boardname&gt;.&lt;entry&gt;</li>
<li>尝试 &lt;entry&gt;</li>
</ol>
<p>举一个例子。下面的sw-description描述了一组板子的发布。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">software</span> <span class="o">=</span>
<span class="p">{</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">;</span>

        <span class="n">myboard</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">stable</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">copy</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                        <span class="p">{</span>
                                <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mtd4&quot;</span>
                                <span class="o">...</span>
                        <span class="p">}</span>
                        <span class="p">);</span>
                <span class="p">}</span>
                <span class="n">copy</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                        <span class="p">{</span>
                                <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mtd5&quot;</span>
                                <span class="o">...</span>
                        <span class="p">}</span>
                        <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stable</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">copy</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
                  <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                      <span class="p">{</span>
                           <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mtd6&quot;</span>
                                <span class="o">...</span>
                      <span class="p">}</span>
                   <span class="p">);</span>
            <span class="p">}</span>
            <span class="n">copy</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span>
                   <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                   <span class="p">{</span>
                           <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mtd7&quot;</span>
                                <span class="o">...</span>
                   <span class="p">}</span>
                   <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在 <em>myboard</em> 上运行时，SWUpdate会搜索并找到myboard.stable.copy1(2)。
当在其他板子上运行时，SWUpdate则无法找到一个与板子名字对应的条目，
那它就会退回到没有指定板子名字的版本。
这样就可以使用一个发布版本，适配拥有完全不同硬件的不同板子。
例如, <cite>myboard</cite> 可以是eMMC和ext4文件系统，而另一个设备可以是raw flash并安装
UBI文件系统。然而，它们都是同一版本的不同格式，可以在sw-description中一起描述。
重要的是，要理解SWUpdate在解析期间如何按优先级扫描条目。</p>
</div>
<div class="section" id="using-links">
<h2>Using links<a class="headerlink" href="#using-links" title="永久链接至标题">¶</a></h2>
<p>sw-description可能变得非常复杂。
让我们假设只有一个板子，但是存在多个硬件版本，它们在硬件上是不同的。
这些版本中有些可以统一处理，有些则需要特殊的部分。
一种方法(但不是唯一的方法!)是添加 <em>mode</em> 并使用 <cite>-e stable,&lt;rev number&gt;</cite> 做选择。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">software</span> <span class="o">=</span>
<span class="p">{</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">;</span>

        <span class="n">myboard</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">stable</span> <span class="o">=</span> <span class="p">{</span>

                <span class="n">hardware</span><span class="o">-</span><span class="n">compatibility</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;1.2&quot;</span><span class="p">,</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span> <span class="s2">&quot;1.§, &quot;</span><span class="mf">3.0</span><span class="s2">&quot;, &quot;</span><span class="mf">3.1</span><span class="s2">&quot;];</span>
                <span class="n">rev</span><span class="o">-</span><span class="mf">1.0</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                                <span class="o">...</span>
                        <span class="p">);</span>
                        <span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
                                <span class="o">...</span>
                        <span class="p">);</span>
                <span class="p">}</span>
                <span class="n">rev</span><span class="o">-</span><span class="mf">1.2</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">hardware</span><span class="o">-</span><span class="n">compatibility</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1.2&quot;</span><span class="p">];</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                                <span class="o">...</span>
                        <span class="p">);</span>
                        <span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
                                <span class="o">...</span>
                        <span class="p">);</span>
                <span class="p">}</span>
                <span class="n">rev</span><span class="o">-</span><span class="mf">2.0</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">hardware</span><span class="o">-</span><span class="n">compatibility</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2.0&quot;</span><span class="p">];</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                                <span class="o">...</span>
                        <span class="p">);</span>
                        <span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
                           <span class="o">...</span>
                        <span class="p">);</span>
                <span class="p">}</span>
                <span class="n">rev</span><span class="o">-</span><span class="mf">1.3</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">hardware</span><span class="o">-</span><span class="n">compatibility</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1.3&quot;</span><span class="p">];</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                            <span class="o">...</span>
                        <span class="p">);</span>
                        <span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
                            <span class="o">...</span>
                        <span class="p">);</span>
                <span class="p">}</span>

                <span class="n">rev</span><span class="o">-</span><span class="mf">3.0</span><span class="p">:</span>
                <span class="p">{</span>
                        <span class="n">hardware</span><span class="o">-</span><span class="n">compatibility</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;3.0&quot;</span><span class="p">];</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                                <span class="o">...</span>
                        <span class="p">);</span>
                        <span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
                                <span class="o">...</span>
                        <span class="p">);</span>
                <span class="p">}</span>
                <span class="n">rev</span><span class="o">-</span><span class="mf">3.1</span><span class="p">:</span>
                <span class="p">{</span>
                        <span class="n">hardware</span><span class="o">-</span><span class="n">compatibility</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;3.1&quot;</span><span class="p">];</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                                <span class="o">...</span>
                        <span class="p">);</span>
                        <span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
                                <span class="o">...</span>
                        <span class="p">);</span>
                <span class="p">}</span>
             <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>如果它们每个都需要一个单独的部分，那么这是一种方法。
尽管如此，更可能的情况时，不同的修订版本可以被当成一类，
例如，具有相同主要修订号的板子可能具有相同的安装说明。
在这个例子中，则可导出三个分组，rev1.X, rev2.X 和 rev3.X。
链接允许将部分分组在一起。当SWUpdate搜索组
(images、files、scripts、bootenv)时，如果发现“ref”，
它将用字符串的值替换树中的当前路径。这样，上面的例子可以这样写:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">software</span> <span class="o">=</span>
 <span class="p">{</span>
         <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">;</span>

         <span class="n">myboard</span> <span class="o">=</span> <span class="p">{</span>
             <span class="n">stable</span> <span class="o">=</span> <span class="p">{</span>

                 <span class="n">hardware</span><span class="o">-</span><span class="n">compatibility</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;1.2&quot;</span><span class="p">,</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span> <span class="s2">&quot;1.3, &quot;</span><span class="mf">3.0</span><span class="s2">&quot;, &quot;</span><span class="mf">3.1</span><span class="s2">&quot;];</span>
                 <span class="n">rev</span><span class="o">-</span><span class="mi">1</span><span class="n">x</span><span class="p">:</span> <span class="p">{</span>
                         <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                            <span class="o">...</span>
                         <span class="p">);</span>
                         <span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
                             <span class="o">...</span>
                         <span class="p">);</span>
                 <span class="p">}</span>
                 <span class="n">rev1</span><span class="o">.</span><span class="mi">0</span> <span class="o">=</span> <span class="p">{</span>
                         <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./rev-1x&quot;</span><span class="p">;</span>
                 <span class="p">}</span>
                 <span class="n">rev1</span><span class="o">.</span><span class="mi">2</span> <span class="o">=</span> <span class="p">{</span>
                         <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./rev-1x&quot;</span><span class="p">;</span>
                 <span class="p">}</span>
                 <span class="n">rev1</span><span class="o">.</span><span class="mi">3</span> <span class="o">=</span> <span class="p">{</span>
                         <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./rev-1x&quot;</span><span class="p">;</span>
                 <span class="p">}</span>
                 <span class="n">rev</span><span class="o">-</span><span class="mi">2</span><span class="n">x</span><span class="p">:</span> <span class="p">{</span>
                         <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                              <span class="o">...</span>
                         <span class="p">);</span>
                         <span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
                              <span class="o">...</span>
                         <span class="p">);</span>
                 <span class="p">}</span>
                 <span class="n">rev2</span><span class="o">.</span><span class="mi">0</span> <span class="o">=</span> <span class="p">{</span>
                         <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./rev-2x&quot;</span><span class="p">;</span>
                 <span class="p">}</span>

                 <span class="n">rev</span><span class="o">-</span><span class="mi">3</span><span class="n">x</span><span class="p">:</span> <span class="p">{</span>
                         <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                              <span class="o">...</span>
                         <span class="p">);</span>
                         <span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
                               <span class="o">...</span>
                         <span class="p">);</span>
                 <span class="p">}</span>
                 <span class="n">rev3</span><span class="o">.</span><span class="mi">0</span> <span class="o">=</span> <span class="p">{</span>
                         <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./rev-3x&quot;</span><span class="p">;</span>
                 <span class="p">}</span>
                 <span class="n">rev3</span><span class="o">.</span><span class="mi">1</span> <span class="o">=</span> <span class="p">{</span>
                         <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./rev-3x&quot;</span><span class="p">;</span>
                 <span class="p">}</span>
              <span class="p">}</span>
         <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这种链接可以是绝对的，也可以是相对的。关键字 <em>ref</em>  用于指示一个链接。
如果找到链接，SWUpdate将遍历树，并将当前路径替换为 “ref” 指向的字符串中的值。
用于链接的规则很简单：</p>
<blockquote>
<div><ul class="simple">
<li>必须以字符 ‘#’ 开头</li>
<li>“.” 指向树中的当前层级，即 “ref” 的父级</li>
<li>“..” 指向树中的父级</li>
<li>“/” 在链接中用作字段分隔符</li>
</ul>
</div></blockquote>
<p>一个相对路径有许多前导 “../” 以从当前位置移动到树的高层级节点
在下面的例子中，rev40设置了一个链接到 “common”, 在那可以找到 “images”。
这也是通过链接到父节点中的一个部分来设置的。
路径 <cite>software.myboard.stable.common.images</cite> 被替换为
<cite>software.myboard.stable.trythis</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">software</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="n">version</span> <span class="o">=</span> <span class="p">{</span>
          <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./commonversion&quot;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">hardware</span><span class="o">-</span><span class="n">compatibility</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rev10&quot;</span><span class="p">,</span> <span class="s2">&quot;rev11&quot;</span><span class="p">,</span> <span class="s2">&quot;rev20&quot;</span><span class="p">];</span>

  <span class="n">commonversion</span> <span class="o">=</span> <span class="s2">&quot;0.7-linked&quot;</span><span class="p">;</span>

<span class="n">pc</span><span class="p">:{</span>
  <span class="n">stable</span><span class="p">:{</span>

    <span class="n">common</span><span class="p">:{</span>
        <span class="n">images</span> <span class="o">=</span>
        <span class="p">{</span>
          <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./../trythis&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">};</span>

    <span class="n">trythis</span><span class="p">:(</span>
        <span class="p">{</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;rootfs1.ext4&quot;</span><span class="p">;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mmcblk0p8&quot;</span><span class="p">;</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="p">,</span>
        <span class="p">{</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;rootfs5.ext4&quot;</span><span class="p">;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mmcblk0p7&quot;</span><span class="p">;</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">);</span>
    <span class="n">pdm3rev10</span><span class="p">:</span>
      <span class="p">{</span>
      <span class="n">images</span><span class="p">:(</span>
          <span class="p">{</span>
          <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;rootfs.ext3&quot;</span><span class="p">;</span> <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mmcblk0p2&quot;</span><span class="p">;}</span>
        <span class="p">);</span>
      <span class="n">uboot</span><span class="p">:(</span>
          <span class="p">{</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;bootpart&quot;</span><span class="p">;</span>
          <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;0:2&quot;</span><span class="p">;}</span>
        <span class="p">);</span>
      <span class="p">};</span>
      <span class="n">pdm3rev11</span> <span class="o">=</span>
      <span class="p">{</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./pdm3rev10&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">pdm3rev20</span> <span class="o">=</span>
      <span class="p">{</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./pdm3rev10&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">pdm3rev40</span> <span class="o">=</span>
      <span class="p">{</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;#./common&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>可以通过链接重定向sw-description中的每个条目，就像上面示例中的 “version” 属性那样。</p>
</div>
<div class="section" id="id5">
<h2>硬件兼容性<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>硬件兼容性: [ “major.minor”, “major.minor”, … ]</p>
<p>它列出了与此软件镜像兼容的硬件修订版本。</p>
<p>例子:</p>
<blockquote>
<div>hardware-compatibility: [ “1.0”, “1.2”, “1.3”];</div></blockquote>
<p>这意味着该软件可以兼容硬件修订版本1.0, 1.2 和 1.3,但不能兼容1.1
和其他未在此明确列出的版本。
如何找到正在运行SWUpdate的板子的修订版本，是另一件事情了。
这里并没有假设如何获得修订版本（可以通过GPIOs,EEPROM等),
每个项目都可以自由选择最合适的方式。
在启动SWUpdate之前，结果必须写入文件/etc/hwrevision(如果配置中
指定了另一个文件，则必须写入对应的文件)。</p>
</div>
<div class="section" id="partitions-ubi">
<h2>partitions : UBI 布局<a class="headerlink" href="#partitions-ubi" title="永久链接至标题">¶</a></h2>
<p>此标记允许更改UBI卷的布局。
请注意，此处不涉及MTDs，它们是由设备树配置的，
或者直接在内核中以另一种方式配置的。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">partitions</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">name</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">volume</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="n">size</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">size</span> <span class="ow">in</span> <span class="nb">bytes</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="n">device</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">MTD</span> <span class="n">device</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="p">},</span>
<span class="p">);</span>
</pre></div>
</div>
<p>所有字段都是强制的。SWUpdate搜索所选名称的卷并调整大小，
如果不存在具有给定名称的卷，则创建新卷。
在后一种情况下，它是在连接到”device”所指定MTD设备的UBI设备上创建的。
“device”可以以数字(如 “mtd4”)或名字(及MTD设备的名字，如 “ubi_partition”)
的方式给出。UBI设备的连接是自动进行的。</p>
</div>
<div class="section" id="images">
<h2>images<a class="headerlink" href="#images" title="永久链接至标题">¶</a></h2>
<p>标签 “images” 收集安装到系统中的映像。
语法是:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">images</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">filename</span><span class="p">[</span><span class="n">mandatory</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Name</span> <span class="ow">in</span> <span class="n">CPIO</span> <span class="n">Archive</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="n">volume</span><span class="p">[</span><span class="n">optional</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">destination</span> <span class="n">volume</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="n">device</span><span class="p">[</span><span class="n">optional</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">destination</span> <span class="n">volume</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="n">mtdname</span><span class="p">[</span><span class="n">optional</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">destination</span> <span class="n">mtd</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="nb">type</span><span class="p">[</span><span class="n">optional</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">handler</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="o">/*</span> <span class="n">optionally</span><span class="p">,</span> <span class="n">the</span> <span class="n">image</span> <span class="n">can</span> <span class="n">be</span> <span class="n">copied</span> <span class="n">at</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">offset</span> <span class="o">*/</span>
                <span class="n">offset</span><span class="p">[</span><span class="n">optional</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">offset</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="o">/*</span> <span class="n">optionally</span><span class="p">,</span> <span class="n">the</span> <span class="n">image</span> <span class="n">can</span> <span class="n">be</span> <span class="n">compressed</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">raw</span> <span class="n">mode</span> <span class="o">*/</span>
                <span class="n">compressed</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="o">/*</span> <span class="n">Next</span> <span class="n">Image</span> <span class="o">*/</span>
        <span class="o">.....</span>
<span class="p">);</span>
</pre></div>
</div>
<p><em>volume</em> 仅用于将镜像安装到UBI卷中。 <em>volume</em> 和 <em>device</em> 不能同时使用。
如果设置了device,则会自动选中裸数据处理程序(raw handler)。</p>
<p>以下时一个更新UBI卷的例子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;core-image-base.ubifs&quot;</span><span class="p">;</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="s2">&quot;rootfs&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>要以裸数据形式更新体格镜像，语法如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;core-image-base.ext3&quot;</span><span class="p">;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mmcblk0p1&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>要将镜像写入到一个指定偏移处，语法如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;u-boot.bin&quot;</span><span class="p">;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mmcblk0p1&quot;</span><span class="p">;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="s2">&quot;16K&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>偏移量可处理以下乘法后缀:K=1024和M=1024*1024。</p>
<p>但是，在裸数据模式下写flash必须以一种特殊的方式进行管理。
Flash在写入之前必须先擦除，并且写入NAND时必须处理坏块和ECC错误。
因此，必须选择处理程序”flash”:</p>
<p>例如，要将内核复制到NAND闪存的MTD7中:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;uImage&quot;</span><span class="p">;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;mtd7&quot;</span><span class="p">;</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;flash&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>filename</em> 是必须的。它是由流提取的文件的名称。
<em>volume</em> 仅在UBI卷中是强制性的。它不应该在其他情况下使用。</p>
<p>另外，对于处理程序 “flash”，可以指定 <em>mtdname</em> 来代替设备名称:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;uImage&quot;</span><span class="p">;</span>
        <span class="n">mtdname</span> <span class="o">=</span> <span class="s2">&quot;kernel&quot;</span><span class="p">;</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;flash&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="files">
<h2>Files<a class="headerlink" href="#files" title="永久链接至标题">¶</a></h2>
<p>可以复制单个文件而不是完整镜像。
这不是首选的方法，但是可以用于调试或特殊目的。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Name</span> <span class="ow">in</span> <span class="n">CPIO</span> <span class="n">Archive</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="n">path</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">path</span> <span class="ow">in</span> <span class="n">filesystem</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="n">device</span><span class="p">[</span><span class="n">optional</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">device</span> <span class="n">node</span> <span class="o">&gt;</span><span class="p">;</span>
                <span class="n">filesystem</span><span class="p">[</span><span class="n">optional</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">filesystem</span> <span class="k">for</span> <span class="n">mount</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="n">properties</span><span class="p">[</span><span class="n">optional</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">create</span><span class="o">-</span><span class="n">destination</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span><span class="p">;}</span>
        <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>“files” 部分中的条目会作为单个文件进行管理。
“filename” 和 “path” 属性是必须的。
属性 “device” 和 “filesystem” 是可选的;
它们用于告诉SWUpdate，在将”filename”拷贝到”path”之前
先挂载设备(以给定的文件系统类型进行挂载，如 “ext4”)。
如果没有指定”device”和”filesystem”，
则”filename”会被拷贝到当前根文件系统的”path”。</p>
<p>一般来说，如果目标路径不存在，swupdate不会复制文件。
可以使用特殊属性”create-destination”更改此行为。</p>
</div>
<div class="section" id="scripts">
<h2>Scripts<a class="headerlink" href="#scripts" title="永久链接至标题">¶</a></h2>
<p>脚本按照它们被放入sw-description文件的顺序运行。
脚本的结果由SWUpdate进行评估，如果结果是&lt;&gt; 0，则停止更新并报错。</p>
<p>它们在执行之前会被复制到一个临时目录中，
并且它们的名字在同一个cpio归档中必须是惟一的。</p>
<p>如果没有给出类型，SWUpdate默认为 “lua”。</p>
<div class="section" id="lua">
<h3>Lua<a class="headerlink" href="#lua" title="永久链接至标题">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Name</span> <span class="ow">in</span> <span class="n">CPIO</span> <span class="n">Archive</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;lua&quot;</span><span class="p">;</span>
        <span class="p">},</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Lua脚本使用内部解释器运行。</p>
<p>它们必须具有下列函数中的至少一个:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">preinst</span><span class="p">()</span>
</pre></div>
</div>
<p>SWUpdate扫描所有脚本并检查preinst函数。在安装镜像之前调用它。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">postinst</span><span class="p">()</span>
</pre></div>
</div>
<p>SWUpdate扫描所有脚本并检查postinst函数。它是在安装镜像之后调用的。</p>
</div>
<div class="section" id="shellscript">
<h3>shellscript<a class="headerlink" href="#shellscript" title="永久链接至标题">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Name</span> <span class="ow">in</span> <span class="n">CPIO</span> <span class="n">Archive</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;shellscript&quot;</span><span class="p">;</span>
        <span class="p">},</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Shell脚本通过system命令调用。
SWUpdate扫描所有脚本，并在安装镜像之前和之后调用它们。
SWUpdate将’preinst’或’postinst’作为脚本的第一个参数传递。
如果定义了data属性，它的值将作为最后一个参数传递给脚本。</p>
</div>
<div class="section" id="preinstall">
<h3>preinstall<a class="headerlink" href="#preinstall" title="永久链接至标题">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Name</span> <span class="ow">in</span> <span class="n">CPIO</span> <span class="n">Archive</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;preinstall&quot;</span><span class="p">;</span>
        <span class="p">},</span>
<span class="p">);</span>
</pre></div>
</div>
<p>preinstall 是通过system命令调用的shell脚本。
SWUpdate扫描所有脚本并在安装映像之前调用它们。
如果定义了data属性，它的值将作为最后一个参数传递给脚本。</p>
</div>
<div class="section" id="postinstall">
<h3>postinstall<a class="headerlink" href="#postinstall" title="永久链接至标题">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scripts</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Name</span> <span class="ow">in</span> <span class="n">CPIO</span> <span class="n">Archive</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;postinstall&quot;</span><span class="p">;</span>
        <span class="p">},</span>
<span class="p">);</span>
</pre></div>
</div>
<p>postinstall 是通过system命令调用的shell脚本。
SWUpdate扫描所有脚本，并在安装镜像后调用它们。
如果定义了data属性，它的值将作为最后一个参数传递给脚本。</p>
</div>
</div>
<div class="section" id="bootloader">
<h2>bootloader<a class="headerlink" href="#bootloader" title="永久链接至标题">¶</a></h2>
<p>有两种方法可以更新引导加载程序(当前支持U-Boot、GRUB和EFI Boot Guard)
的环境变量。
第一种方法是添加一个包含要更改的变量列表的文件，
并将“bootloader”设置为镜像的类型。
这将通知SWUpdate调用引导加载程序处理程序来处理文件
(需要在配置中启用引导加载程序处理程序)。
对于所有受支持的引导加载程序，都有一个引导加载程序处理程序。
必须从 <cite>menuconfig</cite> 的引导加载程序选择菜单中选择适当的引导加载程序。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bootenv</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;bootloader-env&quot;</span><span class="p">;</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;bootloader&quot;</span><span class="p">;</span>
        <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>文件的格式在U-boot文档中有描述。每一行都是如下格式</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">name</span> <span class="n">of</span> <span class="n">variable</span><span class="o">&gt;</span>      <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>如果值缺失，则变量将被去掉。
在当前实现中，GRUB和EFI Boot Guard 的环境变量修改也继承了上述文件格式。</p>
<p>第二种方法是在组设置中定义需要更改的变量:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bootenv</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">name</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Variable</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Variable</span> <span class="n">value</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>SWUpdate将在内部生成一个脚本，该脚本将传递给
引导加载程序处理程序，用于调整环境变量。</p>
<p>为了向后兼容以前构建的 <cite>.swu</cite>  镜像，”uboot” 组名仍然作为别名支持。
但是，它实际上已经被弃用了，不建议继续使用它。</p>
</div>
<div class="section" id="id6">
<h2>特定的板级设置<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>每个设置都可以放在与板名匹配的自定义标记下。
此机制可用于以板卡特有的方式覆盖特定设置。</p>
<p>假设硬件信息文件 <cite>/etc/hwrevision</cite> 包含以下条目:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my</span><span class="o">-</span><span class="n">board</span> <span class="mf">0.1</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>以及以下描述:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">software</span> <span class="o">=</span>
<span class="p">{</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">;</span>

        <span class="n">my</span><span class="o">-</span><span class="n">board</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">bootenv</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">{</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;bootpart&quot;</span><span class="p">;</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;0:2&quot;</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="p">);</span>
        <span class="p">};</span>

        <span class="n">bootenv</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;bootpart&quot;</span><span class="p">;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;0:1&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>SWUpdate将在这个板子的引导加载程序环境中将 <cite>bootpart</cite> 设置为 <cite>0:2</cite> 。
对于所有其他板子， <cite>bootpart</cite> 将被设置为 <cite>0:1</cite> 。
特定于板子的设置优先于默认作用域的设置。</p>
</div>
<div class="section" id="id7">
<h2>软件集合和操作模式<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<p>软件集合和操作模式扩展了描述文件语法，
以提供对之前介绍的所有配置标记的叠加分组。
这种机制类似于 <a class="reference internal" href="#id6">特定的板级设置</a> ,可用于实现双拷贝策略，
或者用单个更新文件内同时交付稳定和不稳定版本的镜像。</p>
<p>该机制使用放置在 <cite>software</cite> 标签范围内的自定义用户定义标签。
标签不能使用以下名字: <cite>version</cite>, <cite>hardware-compatibility</cite>,
<cite>uboot</cite>, <cite>bootenv</cite>, <cite>files</cite>, <cite>scripts</cite>, <cite>partitions</cite>, <cite>images</cite></p>
<p>示例描述文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">software</span> <span class="o">=</span>
<span class="p">{</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span><span class="p">;</span>

        <span class="n">hardware</span><span class="o">-</span><span class="n">compatibility</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;revA&quot;</span> <span class="p">];</span>

        <span class="o">/*</span> <span class="n">differentiate</span> <span class="n">running</span> <span class="n">image</span> <span class="n">modes</span><span class="o">/</span><span class="n">sets</span> <span class="o">*/</span>
        <span class="n">stable</span><span class="p">:</span>
        <span class="p">{</span>
                <span class="n">main</span><span class="p">:</span>
                <span class="p">{</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                        <span class="p">{</span>
                                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;rootfs.ext3&quot;</span><span class="p">;</span>
                                <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mmcblk0p2&quot;</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="p">);</span>

                        <span class="n">bootenv</span><span class="p">:</span> <span class="p">(</span>
                        <span class="p">{</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;bootpart&quot;</span><span class="p">;</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;0:2&quot;</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="p">);</span>
                <span class="p">};</span>
                <span class="n">alt</span><span class="p">:</span>
                <span class="p">{</span>
                        <span class="n">images</span><span class="p">:</span> <span class="p">(</span>
                        <span class="p">{</span>
                                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;rootfs.ext3&quot;</span><span class="p">;</span>
                                <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;/dev/mmcblk0p1&quot;</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="p">);</span>

                        <span class="n">bootenv</span><span class="p">:</span> <span class="p">(</span>
                        <span class="p">{</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;bootpart&quot;</span><span class="p">;</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;0:1&quot;</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="p">);</span>
                <span class="p">};</span>

        <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这个配置描述了一个名为 <cite>stable</cite> 的软件集合。
并为这个集合指定了两个不同的镜像安装位置: <cite>/dev/mmcblk0p1</cite> 和
<cite>/dev/mmcblk0p2</cite> 分别用于 <cite>main</cite> 模式和 <cite>alt</cite> 模式。</p>
<p>该特性可以通过显式指定集合和模式来实现双拷贝策略。</p>
</div>
<div class="section" id="id8">
<h2>检查已安装软件的版本<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<p>SWUpdate支持可选地验证子镜像是否已经被安装了，
如果要安装的版本完全相同，则可以跳过它的安装。
这在安装某些高风险镜像或需要加速升级过程的情况下是非常有用的。</p>
<p>一种情况是需要更新引导加载程序。在大多数情况下，
不需要升级引导加载程序，但是实践表明，在某些情况下，
确实有必要升级 - 项目经理应该承担这个风险。
经过如此，始终将引导加载程序镜像作为.swu文件的一部分是更好的，
这样可以在单个文件中获得设备的整个发行版，但是设备应该仅在必要时安装它。</p>
<p>SWUpdate搜索包含已安装映像的所有版本信息的文件(默认位置是/etc/sw-versions)。
这个文件必须在运行SWUpdate之前生成。</p>
<p>文件必须包含成对的信息，即镜像名称和版本:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">name</span> <span class="n">of</span> <span class="n">component</span><span class="o">&gt;</span>     <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>版本是一个字符串，可以有任何值。例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bootloader</span>              <span class="mf">2015.01</span><span class="o">-</span><span class="n">rc3</span><span class="o">-</span><span class="mi">00456</span><span class="o">-</span><span class="n">gd4978d</span>
<span class="n">kernel</span>                  <span class="mf">3.17</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mi">00215</span><span class="o">-</span><span class="n">g2e876af</span>
</pre></div>
</div>
<p>在sw-description中，可选属性 “name”、”version”
和”install-if-different”提供了连接。
name和version将用于与版本文件中的数据进行比较。
install-if-different则是一个布尔值，用于对此镜像启用版本检查。
这样就可以只对要安装的镜像们的一个子集进行版本检查。</p>
</div>
<div class="section" id="id9">
<h2>嵌入脚本<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<p>可以将脚本嵌入到sw-description中。这在许多情况下非常有用，
因为一些参数只有在目标上实际运行时知道。
脚本是全局的，面向所有部分，但是它可以包含几个函数，
这些函数可以针对sw-description文件中的每个条目。</p>
<p>这些属性用于嵌入脚本:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">embedded</span><span class="o">-</span><span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&lt;Lua code&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>必须考虑到解析器已经在运行，双引号的使用可能会干扰解析器。
因此，脚本中的每个双引号都必须转义。</p>
<p>这意味着像这样的一个简单的Lua代码:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>修改改成这样:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span>\<span class="s2">&quot;Test</span><span class="se">\&quot;</span><span class="s2">)</span>
</pre></div>
</div>
<p>不然解析器会认为脚本已经关闭，并产生一个错误。
有关如何使用它的示例，请参见示例目录。
文件或镜像中的任何条目都可以触发脚本中的一个函数。
“hook” 属性告诉解析器加载脚本并搜索钩子属性指向的函数。例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">{</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;examples.tar&quot;</span><span class="p">;</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;archive&quot;</span><span class="p">;</span>
                <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/tmp/test&quot;</span><span class="p">;</span>
                <span class="n">hook</span> <span class="o">=</span> <span class="s2">&quot;set_version&quot;</span><span class="p">;</span>
                <span class="n">preserve</span><span class="o">-</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>在解析条目之后，解析器运行hook所指向的Lua函数。
如果Lua未被激活，解析器将引发一个错误，
因为必须解析带有嵌入脚本的sw-description，但解释器不可用。
每个Lua函数接收一个带有当前条目设置的表作为参数。
Lua钩子的格式是:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">lua_hook</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
<p>参数image是一个表，其关键字是有效属性的列表。
如果一个属性包含了”-“，则会被替换为”_”，因为Lua中不能使用 “-“。
这意味着，如下例子：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">install</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">different</span> <span class="o">==&gt;</span> <span class="n">install_if_different</span>
<span class="n">install</span><span class="o">-</span><span class="n">directly</span>     <span class="o">==&gt;</span> <span class="n">install_directly</span>
</pre></div>
</div>
<p>可以在Lua脚本中更改属性，并在返回时接管值。
Lua函数必须返回2个值:</p>
<blockquote>
<div><ul class="simple">
<li>一个布尔值，指示解析是否正确</li>
<li>镜像表或nil以表示应该跳过该镜像</li>
</ul>
</div></blockquote>
<p>例子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">set_version</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span>\<span class="s2">&quot;RECOVERY_STATUS.RUN: </span><span class="se">\&quot;</span><span class="s2">.. swupdate.RECOVERY_STATUS.RUN)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="n">do</span>
                <span class="n">swupdate</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span>\<span class="s2">&quot;image[</span><span class="se">\&quot;</span><span class="s2"> .. tostring(k) .. </span><span class="se">\&quot;</span><span class="s2">] = </span><span class="se">\&quot;</span><span class="s2"> .. tostring(l))</span>
        <span class="n">end</span>
        <span class="n">image</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> \<span class="s2">&quot;1.0</span><span class="se">\&quot;</span>
        <span class="n">image</span><span class="o">.</span><span class="n">install_if_different</span> <span class="o">=</span> <span class="n">true</span>
        <span class="k">return</span> <span class="n">true</span><span class="p">,</span> <span class="n">image</span>
<span class="n">end</span>
</pre></div>
</div>
<p>该示例为已安装镜像设置了一个版本。
通常，这是在运行时从目标读取数据检测到的。</p>
</div>
<div class="section" id="sw-description-attribute-reference">
<span id="id10"></span><h2>属性参考<a class="headerlink" href="#sw-description-attribute-reference" title="永久链接至标题">¶</a></h2>
<p>在sw-description中有4个主要部分:</p>
<ul class="simple">
<li>images: 条目是镜像，SWUpdate对它们一无所知。</li>
<li>files: 条目是文件，SWUpdate需要一个用于它们的文件系统。
这通常用于从tar-ball展开或更新单个文件。</li>
<li>scripts: 所有条目都被视为可执行文件，它们将被运行两次(作为安装前和安装后脚本)。</li>
<li>bootenv:条目是引导加载程序环境变量名及其值的键值对。</li>
</ul>
<table border="1" class="docutils" id="id11">
<caption><span class="caption-text">Attributes in sw-description</span><a class="headerlink" href="#id11" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="18%" />
<col width="14%" />
<col width="16%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">名字</th>
<th class="head">类型</th>
<th class="head">应用于</th>
<th class="head">描述</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>filename</td>
<td>string</td>
<td>images
files
scripts</td>
<td>在cpio存档中找到的文件名。</td>
</tr>
<tr class="row-odd"><td>volume</td>
<td>string</td>
<td>images</td>
<td>仅在 type = “ubivol”时使用。
指明镜像将安装到哪个UBI卷。</td>
</tr>
<tr class="row-even"><td>ubipartition</td>
<td>string</td>
<td>images</td>
<td>仅在 type = “ubivol”时使用。
要创建或调整大小的UBI卷。</td>
</tr>
<tr class="row-odd"><td>device</td>
<td>string</td>
<td>images
files</td>
<td>在/dev下可找到的设备节点，或者是到它的
符号链接。 可以指定为绝对路径，或/dev
下的名字。例如，如果/dev/mtd-dev是一个
指向/dev/mtd3的链接，则 “mtd3”,
“mtd-dtb”,”/dev/mtd3”和”/dev/mtd-dtb”
均是有效的名字。
用法取决于具体处理程序。
对于文件，用于指明哪个设备用于挂载
“filesystem”，如果未指定，则使用当前的
根文件系统。</td>
</tr>
<tr class="row-even"><td>filesystem</td>
<td>string</td>
<td>files</td>
<td>指示文件安装位置的文件系统类型。
仅在设置了”device”属性时使用。</td>
</tr>
<tr class="row-odd"><td>path</td>
<td>string</td>
<td>files</td>
<td>用于文件:指示用于安装文件的路径
(绝对路径)。如果设置了”device” 和
“filesystem”, Swupdate将在以指定文件
系统类型挂载设备后再安装文件。
(路径总是相对于挂载点而言的)</td>
</tr>
<tr class="row-even"><td>preserve-attributes</td>
<td>bool</td>
<td>files</td>
<td>标记，用于控制从归档文件解压文件时
是否保留下列属性
(当然，前提是目标文件系统支持它们):
timestamp, uid/gid (numeric), perms,
file attributes, extended attributes</td>
</tr>
<tr class="row-odd"><td>type</td>
<td>string</td>
<td>images
files
scripts</td>
<td>处理程序的字符串标识符，
它是由处理程序在注册自身时设置的。
例如: “ubivol”, “raw”, “rawfile”</td>
</tr>
<tr class="row-even"><td>compressed</td>
<td>bool</td>
<td>images
files</td>
<td>标记，用于指示”filename”是zlib压缩的，
在安装之前必须先解压</td>
</tr>
<tr class="row-odd"><td>installed-directly</td>
<td>bool</td>
<td>images</td>
<td>标志，用于指示镜像需流式更新到目标中,
不需要任何临时副本。
并非所有处理程序都支持流式更新。</td>
</tr>
<tr class="row-even"><td>name</td>
<td>string</td>
<td>bootenv</td>
<td>要设置的引导程序环境变量的名字。</td>
</tr>
<tr class="row-odd"><td>value</td>
<td>string</td>
<td>bootenv</td>
<td>要赋给引导加载程序环境变量的值。</td>
</tr>
<tr class="row-even"><td>name</td>
<td>string</td>
<td>images
files</td>
<td>标识sw-component的名称，它可以是任何
字符串，将与sw-versions中的条目做比较</td>
</tr>
<tr class="row-odd"><td>version</td>
<td>string</td>
<td>images
files</td>
<td>sw-component的版本，可以是任何字符串，
将与sw-version中的条目做比较</td>
</tr>
<tr class="row-even"><td>description</td>
<td>string</td>
<td>&#160;</td>
<td>swupdate归档文件的用户友好的描述
(可使用任意字符串)</td>
</tr>
<tr class="row-odd"><td>install-if-different</td>
<td>bool</td>
<td>images
files</td>
<td>标志
如果设置了，名字和版本会于版本文件中
的条目做比较。</td>
</tr>
<tr class="row-even"><td>encrypted</td>
<td>bool</td>
<td>images
files
scripts</td>
<td>标志
如果设置了, 文件会被加密并必须先解密后
安装。</td>
</tr>
<tr class="row-odd"><td>data</td>
<td>string</td>
<td>images
files
scripts</td>
<td>用于将任意数据传递给处理程序。</td>
</tr>
<tr class="row-even"><td>sha256</td>
<td>string</td>
<td>images
files
scripts</td>
<td>镜像、文件或脚本的sha256哈希值。
用于签名镜像的校验。</td>
</tr>
<tr class="row-odd"><td>embedded-script</td>
<td>string</td>
<td>&#160;</td>
<td>嵌入sw-description文件中的Lua代码。</td>
</tr>
<tr class="row-even"><td>offset</td>
<td>string</td>
<td>images</td>
<td>可选的目的位置的偏移量。</td>
</tr>
<tr class="row-odd"><td>hook</td>
<td>string</td>
<td>images
files</td>
<td>解析条目时要调用的函数(Lua)的名称。</td>
</tr>
<tr class="row-even"><td>mtdname</td>
<td>string</td>
<td>images</td>
<td>要更新的MTD的名称。仅被flash处理程序
用来代替具体的设备节点名，以识别要
更新的MTD。</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="signed_images.html" class="btn btn-neutral float-right" title="Update images from verified source" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="swupdate.html" class="btn btn-neutral" title="SWUpdate: 嵌入式系统的软件升级" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2018, Stefano Babic

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>